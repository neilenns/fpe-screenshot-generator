<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>FPE Test Page</title>
    <link rel="stylesheet" href="fpe.css" />
    <link rel="stylesheet" href="https://use.typekit.net/vbh7vdi.css" />
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  </head>
  <body>
    <div id="input-area">
      <textarea
        id="input-string"
        placeholder="Paste the flight plan string here..."
      ></textarea
      ><br />
      <button onclick="populateFPE()">Load</button>
      <button onclick="copyFPEToClipboard()">Copy Screenshot</button>
    </div>

    <div class="fpe-container">
      <!-- Title -->
      <div class="fpe-title">Test</div>
      <div class="fpe-close">&times;</div>
      <!-- Labels -->
      <div class="fpe-aid-label">AID</div>
      <div class="fpe-cruiseid-label">CID</div>
      <div class="fpe-bcn-label">BCN</div>
      <div class="fpe-refresh-label">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
          width="10"
          height="10"
        >
          <title>Generate new BCN</title>
          <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
          <path
            fill="#fff"
            d="M142.9 142.9c-17.5 17.5-30.1 38-37.8 59.8-5.9 16.7-24.2 25.4-40.8 19.5S38.9 198 44.8 181.4c10.8-30.7 28.4-59.4 52.8-83.8 87.2-87.2 228.3-87.5 315.8-1L455 55c6.9-6.9 17.2-8.9 26.2-5.2S496 62.3 496 72v128c0 13.3-10.7 24-24 24H344c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l41.1-41.1c-62.6-61.5-163.1-61.2-225.3 1zM16 312c0-13.3 10.7-24 24-24h128c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-41.1 41.1c62.6 61.5 163.1 61.2 225.3-1 17.5-17.5 30.1-38 37.8-59.8 5.9-16.7 24.2-25.4 40.8-19.5s25.4 24.2 19.5 40.8c-10.8 30.6-28.4 59.3-52.9 83.8-87.2 87.2-228.3 87.5-315.8 1L57 457c-6.9 6.9-17.2 8.9-26.2 5.2S16 449.7 16 440V312.1z"
          />
        </svg>
      </div>
      <div class="fpe-typ-label">TYP</div>
      <div class="fpe-eq-label">EQ</div>
      <div class="fpe-dep-label">DEP</div>
      <div class="fpe-dest-label">DEST</div>
      <div class="fpe-spd-label">SPD</div>
      <div class="fpe-alt-label">ALT</div>
      <div class="fpe-amend">Amend</div>

      <!-- Values -->
      <div class="fpe-aid-box" id="fpe-aid-box"></div>
      <div class="fpe-cruiseid-box" id="fpe-cruiseid-box"></div>
      <div class="fpe-bcn-box" id="fpe-bcn-box"></div>
      <div class="fpe-typ-box" id="fpe-typ-box"></div>
      <div class="fpe-eq-box" id="fpe-eq-box"></div>
      <div class="fpe-dep-box" id="fpe-dep-box"></div>
      <div class="fpe-dest-box" id="fpe-dest-box"></div>
      <div class="fpe-spd-box" id="fpe-spd-box"></div>
      <div class="fpe-alt-box" id="fpe-alt-box"></div>

      <!-- RTE + RMK -->
      <div class="fpe-rte-label">RTE</div>
      <div class="fpe-rte-box" id="fpe-rte-box"></div>

      <div class="fpe-rmk-label">RMK</div>
      <div class="fpe-rmk-box" id="fpe-rmk-box"></div>
    </div>

    <script>
      async function copyFPEToClipboard() {
        const element = document.querySelector(".fpe-container");
        try {
          const canvas = await html2canvas(element, { backgroundColor: null });
          canvas.toBlob(async (blob) => {
            try {
              await navigator.clipboard.write([
                new ClipboardItem({ "image/png": blob }),
              ]);
              alert("Screenshot copied to clipboard!");
            } catch (err) {
              alert("Failed to copy to clipboard: " + err);
            }
          });
        } catch (err) {
          console.error("Error capturing screenshot:", err);
          alert("Screenshot failed: " + err.message);
        }
      }

      function populateFPE() {
        const str = document.getElementById("input-string").value.trim();

        // Split on multiple spaces
        const parts = str.split(/\s{2,}/);
        if (parts.length < 6) {
          alert("Input does not contain enough fields.");
          return;
        }

        // Extract fields
        const aid = parts[0];
        const typeEq = parts[1];
        const bcn = parts[2]; // Updated index from 3 to 2
        const depDest = parts[3].split(" - "); // Updated index from 4 to 3
        const alt = parts[4]; // Updated index from 5 to 4
        const rte = parts.slice(5).join(" "); // in case route contains double spaces

        // Parse type and equipment
        const cleanedTypeEq = typeEq.replace(/^[A-Z]\//, ""); // strip leading "H/" or similar
        const [typ, eq] = cleanedTypeEq.split("/");

        // Random CID
        const cid = Math.floor(Math.random() * (1950000 - 800000 + 1)) + 800000;

        // Random SPD: 80-450, rounded to nearest 5, zero-padded
        const rawSpd = Math.floor(Math.random() * (450 - 80 + 1) + 80);
        const spd = String(Math.round(rawSpd / 5) * 5).padStart(3, "0");
        document.getElementById("fpe-spd-box").textContent = spd;

        // Random name
        const names = [
          "Alex",
          "Bailey",
          "Charlie",
          "Dakota",
          "Emery",
          "Finley",
          "Gray",
          "Harper",
          "Indigo",
          "Jordan",
          "Joss",
          "Logan",
          "Morgan",
          "Nova",
          "Oakley",
          "Parker",
          "Quinn",
          "Riley",
          "Skyler",
          "Taylor",
        ];
        const name = names[Math.floor(Math.random() * names.length)];

        // Assign values
        document.getElementById("fpe-aid-box").textContent = aid;
        document.getElementById("fpe-typ-box").textContent = typ || "";
        document.getElementById("fpe-eq-box").textContent = eq || "";
        document.getElementById("fpe-bcn-box").textContent = bcn;
        document.getElementById("fpe-dep-box").textContent = depDest[0] || "";
        document.getElementById("fpe-dest-box").textContent = depDest[1] || "";
        document.getElementById("fpe-spd-box").textContent = spd;
        document.getElementById("fpe-alt-box").textContent = alt;
        document.getElementById("fpe-rte-box").textContent = rte;

        // Auto-generated fields
        document.getElementById("fpe-cruiseid-box").textContent = cid;
        document.querySelector(
          ".fpe-title"
        ).textContent = `${aid} - ${name} (${cid})`;
      }
    </script>
  </body>
</html>
